var FAKE_DEFERRED={promise:null,reject:function(){},resolve:function(){}},SiestaMixin={componentWillMount:function(){this.listeners=[]},_cancelListeners:function(){for(var n=0;n<this.listeners.length;n++){var t=this.listeners[n];t()}this.listeners=[]},componentWillUnmount:function(){this._cancelListeners()},_listenToModel:function(n,t,e){var i;if(!t.singleton)throw new Error("Cannot listen to a Model if it is not a singleton");return t.one(function(t,s){t?e(t):(i=this[n](s,function(n){e(s,n)}),this.listeners.push(i))}.bind(this)),function(){if(i){var n=this.listeners.indexOf(i);this.listeners.splice(n,1),i()}}.bind(this)},wrapCancelListen:function(n){var t;return"function"==typeof n&&(t=function(){var t=this.listeners.indexOf(n);this.listeners.splice(t,1),n()}.bind(this)),t},listen:function(n,t){var e;return e=n instanceof siesta._internal.Model?this._listenToModel("listen",n,t):n.listen(t),e&&this.listeners.push(e),this.wrapCancelListen(e)},query:function(n,t,e,i){var s=window.Q?window.Q.defer():FAKE_DEFERRED;return i=i||function(){},n.query(t,function(n,t){if(console.log("done"),n)i(n),s.reject(n);else{var r={};r[e]=t,this.setState(r,function(){i(null,t),s.resolve(t)})}}.bind(this)),s.promise},all:function(n){var t,e,i;return arguments[1]instanceof String||"string"==typeof arguments[1]?(e=arguments[1],i=arguments[2]):(t=arguments[1],e=arguments[2],i=arguments[3]),this.query(n,t,e,i)},isReactiveQuery:function(n){return"function"==typeof n.terminate},listenAndSet:function(n){function t(){o[i]=n.results,this.setState(o,function(){this.listen(n,function(){if(this.isReactiveQuery(n)){var t={};t[i]=n.results,this.setState(t)}}.bind(this))})}var e,i,s;"object"==typeof arguments[1]?(e=arguments[1],i=arguments[2],s=arguments[3]):(e={},i=arguments[1],s=arguments[2]);var r=window.Q?window.Q.defer():FAKE_DEFERRED;s=s||function(){};var o={};if(this.isReactiveQuery(n))n.initialised?(t.call(this),s(null,n.results),r.resolve(n.results)):n.init(function(){t.call(this),s(null,n.results),r.resolve(n.results)}.bind(this));else{if(!(n instanceof siesta._internal.Model))throw new Error("Cannot listenAndSet objects of that type");if(!n.singleton)throw new Error("Can only listenAndSet singleton models");n.one().then(function(n){var t={};t[i]=n,this.setState(t),s(null,n),r.resolve(n)}.bind(this)),this.listen(n,function(){this.setState()}.bind(this))}return r.promise}};"undefined"!=typeof module&&(module.exports={SiestaMixin:SiestaMixin}),"undefined"!=typeof window&&(window.SiestaMixin=SiestaMixin);