!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){return a?"*"==a||a.indexOf("*")>-1?a=p:i.isArray(a)||(a=[a]):a=["GET"],n.map(a,function(a){return a.toUpperCase()})}function e(a){if(!this)return new e(a);this._rawOpts=m(!0,{},a),this._opts=a;var b=function(a){return a instanceof RegExp||(a=new RegExp(a,"g")),a}.bind(this);if(this._opts.path){var c=this._opts.path;i.isArray(c)||(c=[c]),this._opts.path=[],n.each(c,function(a){this._opts.path.push(b.call(this,a))}.bind(this))}else this._opts.path=[""];if(this._opts.method=d(this._opts.method),!this._opts.model)throw new Error("Descriptors must be initialised with a model",{opts:a,descriptor:this});if("string"==typeof this._opts.model){if(!this._opts.collection)throw new Error("Passed model as string, but did not specify the collection it belongs to",{opts:a,descriptor:this});var f;if(f="string"==typeof this._opts.collection?l[this._opts.collection]:this._opts.collection,!f)throw new Error("Collection "+this._opts.collection+" does not exist",{opts:a,descriptor:this});var g=f[this._opts.model];if(!g)throw new Error("Model "+this._opts.model+" does not exist",{opts:a,descriptor:this});this._opts.model=g}var h=this._opts.data;if(h&&h.length){var j,o=h.split(".");if(1==o.length)j=o[0];else{var p={};j=p;for(var q=o[0],r=1;r<o.length;r++){var s=o[r];if(r==o.length-1)p[q]=s;else{var t={};p[q]=t,p=t,q=s}}}this._opts.data=j}k.call(this,"path",this._opts),k.call(this,"method",this._opts),k.call(this,"model",this._opts),k.call(this,"data",this._opts),k.call(this,"transforms",this._opts)}var f=siesta._internal,g=f.log,h=f.error.InternalSiestaError,i=f.util,j=i.assert,k=i.defineSubProperty,l=f.CollectionRegistry,m=f.extend,n=i._,o=g.loggerWithName("Descriptor"),p=["POST","PATCH","PUT","HEAD","GET","DELETE","OPTIONS","TRACE","CONNECT"];n.extend(e.prototype,{httpMethods:p,_matchPath:function(a){var b;for(b=0;b<this._opts.path.length;b++){var c=this._opts.path[b];o.trace.isEnabled&&o.trace("Matching path",a,c.toString());var d=c.exec(a);if(o.trace.isEnabled&&(d?o.trace("Matched path successfully",a,c.toString()):o.trace("Failed to match path",a,c.toString())),d)return!0}return!1},_matchMethod:function(a){for(var b=0;b<this.method.length;b++)if(a.toUpperCase()==this.method[b])return!0;return!1},bury:function(a,b){var c=b,d=Object.keys(b);j(1==d.length);for(var e=d[0],f=b;"string"!=typeof f[e];)f=f[e],d=Object.keys(f),j(1==d.length),e=d[0];var g=f[e],h={};return f[e]=h,h[g]=a,c},_embedData:function(a){if(this.data){var b;return"string"==typeof this.data?(b={},b[this.data]=a):b=this.bury(a,m(!0,{},this.data)),b}return a},_extractData:function(a){if(o.debug.isEnabled&&o.debug("_extractData",a),this.data){if("string"==typeof this.data)return a[this.data];var b=Object.keys(this.data);j(1==b.length);for(var c=a,d=this.data;"string"!=typeof d;){b=Object.keys(d),j(1==b.length);var e=b[0];if(d=d[e],c=c[e],!c)break}return c?c[d]:null}return a},_matchConfig:function(a){var b=a.type?this._matchMethod(a.type):{};return b&&(b=a.url?this._matchPath(a.url):{}),b},_matchData:function(a){var b=null;return this.data?a&&(b=this._extractData(a)):b=a,b},match:function(a,b){var c=this._matchConfig(a),d=!!c,e=!1;return d&&(e=this._matchData(b)),e},_transformData:function(a){var b=this.transforms;if("function"==typeof b)a=b(a);else for(var c in b)if(b.hasOwnProperty(c)&&a[c]){var d=b[c],e=a[c];if("string"==typeof d){var f=d.split(".");if(delete a[c],1==f.length)a[f[0]]=e;else{a[f[0]]={};for(var g=a[f[0]],j=1;j<f.length-1;j++){var k=f[j];g[k]={},g=g[k]}g[f[f.length-1]]=e}}else{if("function"!=typeof d)throw new h("Invalid transformer");var l=d(e);i.isArray(l)?(delete a[c],a[l[0]]=l[1]):a[c]=l}}return a}}),c.Descriptor=e,c.resolveMethod=d},{}],2:[function(a,b,c){function d(){return this?(this.requestDescriptors={},void(this.responseDescriptors={})):new d(opts)}function e(a,b){var c=b.model,d=c.collectionName;a[d]||(a[d]=[]),a[d].push(b)}function f(a,b){var c;return c="string"==typeof b?a[b]||[]:a[b.name]||[]}var g=siesta._internal,h=g.util,i=h._,j=g.log,k=j.loggerWithName("Descriptor");i.extend(d.prototype,{registerRequestDescriptor:function(a){e(this.requestDescriptors,a)},registerResponseDescriptor:function(a){k.trace.isEnabled&&k.trace("registerResponseDescriptor"),e(this.responseDescriptors,a)},requestDescriptorsForCollection:function(a){return f(this.requestDescriptors,a)},responseDescriptorsForCollection:function(a){var b=f(this.responseDescriptors,a);return b.length||k.debug.isEnabled&&k.debug("No response descriptors for collection ",this.responseDescriptors),b},reset:function(){this.requestDescriptors={},this.responseDescriptors={}}}),c.DescriptorRegistry=new d},{}],3:[function(a,b){function c(a,b,c){if(z.debug.isEnabled){var d=z.debug,e=a.type+" "+b.status+" "+a.url;z.trace.isEnabled&&c&&(d=z.trace,e+=": "+t.prettyPrint(c)),d(e)}}function d(a){if(z.debug.isEnabled){var b=z.debug,c=a.type+" "+a.url;z.trace.isEnabled&&(b=z.trace),b(c)}}function e(a,b,e,f){var g=this,h=Array.prototype.slice.call(arguments,2),i={},j=this.name;"function"==typeof h[0]?f=h[0]:"object"==typeof h[0]&&(i=h[0],f=h[1]);var k=t.defer();if(i.type=a,!i.url){var l=this.baseURL;i.url=l+b}return void 0===i.parseResponse&&(i.parseResponse=!0),i.success=function(a,b,d){c(i,d,a);var e={data:a,status:b,xhr:d};if(i.parseResponse){for(var h,k,l=y.responseDescriptorsForCollection(g),m=0;m<l.length;m++){var n=l[m];if(k=n.match(i,a)){h=n;break}}if(h)if(z.trace.isEnabled&&z.trace("Model _constructSubOperation data: "+t.prettyPrint(k)),"object"==typeof k){var o=h.model;o.map(k,{override:i.obj},function(a,b){f&&f(a,b,e)})}else f(null,!0,e);else if(f){if(!j)throw new x("Unnamed collection");var p={},q=u.ErrorCode.NoDescriptorMatched;p[u.ErrorField.Code]=q,p[u.ErrorField.Message]=u.Message[q],f(p,null,e)}}else f(null,null,e)},i.error=function(a,b,c){var d={xhr:a,status:b,error:c};f&&f(d,null,d)},d(i),siesta.ext.http.ajax(i),k.promise}function f(a,b,c){this._serialise(b,function(b,d){var e=d;a.fields&&(e={},v.each(a.fields,function(a){e[a]=d[a]})),c(b,e)})}function g(a,b,c){var d,g=this,h=Array.prototype.slice.call(arguments,3),i={};"function"==typeof h[0]?d=h[0]:"object"==typeof h[0]&&(i=h[0],d=h[1]);var j=t.defer(d);d=j.finish.bind(j),h=Array.prototype.slice.call(h,2);var k,l=y.requestDescriptorsForCollection(this);i.type=a;var m=this.baseURL;i.url=m+b;for(var n=0;n<l.length;n++){var o=l[n];if(o._matchConfig(i)){k=o;break}}return k?(z.trace.isEnabled&&z.trace("Matched descriptor: "+k._dump(!0)),f.call(k,c,i,function(f,j){z.trace.isEnabled&&z.trace("_serialise",{err:f,data:j}),f?d&&d(f,null,null):(i.data=j,i.obj=c,v.partial(e,a,b,i,d).apply(g,h))})):d&&(z.trace.isEnabled&&z.trace("Did not match descriptor"),d("No descriptor matched",null,null)),j.promise}function h(a,b){var c,d=Array.prototype.slice.call(arguments,2),f={};"function"==typeof d[0]?c=d[0]:"object"==typeof d[0]&&(f=d[0],c=d[1]);var g=t.defer(c),h=f.deletionMode||"restore";return void 0===f.parseResponse&&(f.parseResponse=!1),e.call(this,"DELETE",a,f,function(a,d,e,f){a?"restore"==h&&b.restore():"success"==h&&b.remove(),c(a,d,e,f),g.finish(a,{x:d,y:e,z:f})}),("now"==h||"restore"==h)&&b.remove(),g.promise}function i(a,b){var c=Array.prototype.slice.call(arguments,2);return v.partial(a?g:e,b).apply(this,c)}function j(){return v.partial(i,!1,"GET").apply(this,arguments)}function k(){return v.partial(i,!1,"OPTIONS").apply(this,arguments)}function l(){return v.partial(i,!1,"TRACE").apply(this,arguments)}function m(){return v.partial(i,!1,"HEAD").apply(this,arguments)}function n(){return v.partial(i,!0,"POST").apply(this,arguments)}function o(){return v.partial(i,!0,"PUT").apply(this,arguments)}function p(){return v.partial(i,!0,"PATCH").apply(this,arguments)}if("undefined"==typeof siesta&&"undefined"==typeof b)throw new Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var q=siesta._internal,r=q.Collection,s=q.log,t=q.util,u=q.error,v=t._,w=a("./descriptor"),x=q.error.InternalSiestaError,y=a("./descriptorRegistry").DescriptorRegistry,z=s.loggerWithName("HTTP"),A={RequestDescriptor:a("./requestDescriptor").RequestDescriptor,ResponseDescriptor:a("./responseDescriptor").ResponseDescriptor,Descriptor:w.Descriptor,_resolveMethod:w.resolveMethod,Serialiser:a("./serialiser"),DescriptorRegistry:a("./descriptorRegistry").DescriptorRegistry,_httpResponse:e,_httpRequest:g,DELETE:h,HTTP_METHOD:i,GET:j,TRACE:l,OPTIONS:k,HEAD:m,POST:n,PUT:o,PATCH:p,_serialiseObject:f,Paginator:a("./paginator")};Object.defineProperty(A,"ajax",{get:function(){var a=B||($?$.ajax:null)||(jQuery?jQuery.ajax:null);if(!a)throw new x("ajax has not been defined and could not find $.ajax or jQuery.ajax");return a},set:function(a){B=a}}),v.extend(r.prototype,{DELETE:h,GET:j,TRACE:l,OPTIONS:k,HEAD:m,POST:n,PUT:o,PATCH:p}),siesta.ext||(siesta.ext={}),siesta.ext.http=A,Object.defineProperties(siesta.ext,{httpEnabled:{get:function(){return void 0!==siesta.ext._httpEnabled?siesta.ext._httpEnabled:!!siesta.ext.http},set:function(a){siesta.ext._httpEnabled=a},enumerable:!0}});var B,C={};v.extend(siesta,{setAjax:function(a){B=a},getAjax:function(){return siesta.ext.http.ajax},serialisers:C,serializers:C}),Object.defineProperties(C,{id:{get:function(){return console.log(siesta.ext.httpEnabled),siesta.ext.httpEnabled?siesta.ext.http.Serialiser.idSerialiser:null}},depth:{get:function(){return siesta.ext.httpEnabled?siesta.ext.http.Serialiser.depthSerializer:null}}}),"undefined"!=typeof b&&(b.exports=A)},{"./descriptor":1,"./descriptorRegistry":2,"./paginator":4,"./requestDescriptor":5,"./responseDescriptor":6,"./serialiser":7}],4:[function(a,b){function c(a){this.opts={},f.extendFromOpts(this.opts,a,{path:"/",model:null,page:"page",queryParams:!0,pageSize:"pageSize",numPages:"numPages",dataPath:"data",count:"count",type:"GET",dataType:"json"},!1),g.extend(this,{numPages:null,count:null}),this.validate()}var d=siesta._internal,e=(d.log,d.error.InternalSiestaError),f=d.util,g=f._,h=a("querystring");g.extend(c.prototype,{_extract:function(a,b,c){if(a)if("function"==typeof a)b=a(b,c);else for(var d=a.split("."),e=0;e<d.length;e++){var f=d[e];b=b[f]}return b},_extractData:function(a,b){return this._extract(this.opts.dataPath,a,b)},_extractNumPages:function(a,b){return this._extract(this.opts.numPages,a,b)},_extractCount:function(a,b){return this._extract(this.opts.count,a,b)},_parseURL:function(a){var b=document.createElement("a");return b.href=a,b},page:function(a,b){var c=this,d={};"function"==typeof a?b=a:a&&(d=a);var e=f.defer(b),i=d.page,j=d.pageSize;b=e.finish.bind(e);var k=siesta.ext.http.ajax,l=g.extend({},this.opts),m=this.opts.model.collection,n=m.baseURL+this.opts.path;if(this.opts.queryParams){var o=this._parseURL(n),p=o.search,q=p.split("?");q.length>1&&(p=q[1]);var r=h.parse(p);i&&(r[this.opts.page]=i),j&&(r[this.opts.pageSize]=j),Object.keys(r).length&&(o.search="?"+h.stringify(r)),n=o.href}else{var s={};i&&(s[this.opts.page]=i),j&&(s[this.opts.pageSize]=j),l.data=s}return g.extend(l,{url:n,success:function(a,d,e){var f=c._extractData(a,e),g=c._extractCount(a,e),h=c._extractNumPages(a,e);c.opts.model.map(f,function(f,i){f?b(f):(c.count=g,c.numPages=h,b(null,i,{data:a,textStatus:d,jqXHR:e}))})},fail:b}),k(l),e.promise},validate:function(){if(!this.opts.model)throw new e("Paginator must have a model")}}),b.exports=c},{querystring:10}],5:[function(a,b,c){function d(a){return this?(e.call(this,a),this._opts.serializer&&(this._opts.serialiser=this._opts.serializer),this._opts.serialiser||(this._opts.serialiser=f.depthSerializer(0)),k.call(this,"serialiser",this._opts),void k.call(this,"serializer",this._opts,"serialiser")):new d(a)}var e=a("./descriptor").Descriptor,f=a("./serialiser"),g=siesta._internal,h=g.util,i=h._,j=g.log,k=h.defineSubProperty,l=j.loggerWithName("Descriptor");d.prototype=Object.create(e.prototype),i.extend(d.prototype,{_serialise:function(a,b){var c=h.defer(b);b=c.finish.bind(c);var d=this;l.trace.isEnabled&&l.trace("_serialise");var e,f=this.serialiser(a,function(a,c){e||(c=d._transformData(c),b&&b(a,d._embedData(c)))});return void 0!==f?(l.trace.isEnabled&&l.trace("serialiser doesnt use a callback"),e=!0,f=d._transformData(f),b&&b(null,d._embedData(f))):l.trace.isEnabled&&l.trace("serialiser uses a callback",this.serialiser),c.promise},_dump:function(a){var b={};b.methods=this.method,b.model=this.model.name,b.path=this._rawOpts.path;var c;c="function"==typeof this._rawOpts.serialiser?"function () { ... }":this._rawOpts.serialiser,b.serialiser=c;var d={};for(var e in this.transforms)if(this.transforms.hasOwnProperty(e)){var f=this.transforms[e];d[e]="function"==typeof f?"function () { ... }":this.transforms[e]}return b.transforms=d,a?h.prettyPrint(b):b}}),c.RequestDescriptor=d},{"./descriptor":1,"./serialiser":7}],6:[function(a,b,c){function d(a){return this?void e.call(this,a):new d(a)}var e=a("./descriptor").Descriptor;d.prototype=Object.create(e.prototype),_.extend(d.prototype,{_extractData:function(a){var b=e.prototype._extractData.call(this,a);return b&&(b=this._transformData(b)),b},_matchData:function(a){var b=e.prototype._matchData.call(this,a);return b&&(b=this._transformData(b)),b},_dump:function(a){var b={};b.methods=this.method,b.model=this.model.name,b.path=this._rawOpts.path;var c={};for(var d in this.transforms)if(this.transforms.hasOwnProperty(d)){var e=this.transforms[d];c[d]="function"==typeof e?"function () { ... }":this.transforms[d]}return b.transforms=c,a?util.prettyPrint(b):b}}),c.ResponseDescriptor=d},{"./descriptor":1}],7:[function(a,b,c){function d(a){var b=a.model.id;return b?a[b]?a[b]:null:void(i.debug.isEnabled&&i.debug("No idfield"))}function e(a,b,c){c=c||function(){},i.trace.isEnabled&&i.trace("depthSerialiser");var d={};j.each(b._attributeNames,function(a){i.trace.isEnabled&&i.trace("field",a),b[a]&&(d[a]=b[a])});var f=[],g=[],h={},k=[];j.each(b._relationshipNames,function(j){i.trace.isEnabled&&i.trace("relationshipField",j);var l=b.__proxies[j];l.isForward&&(i.debug.isEnabled&&i.debug(j),f.push(j),l.get(function(l,m){i.trace.isEnabled&&i.trace("proxy.get",j),i.debug.isEnabled&&i.debug(j,m),l?(g.push(l),k.push(j),h[j]={err:l,v:m}):m?a?e(a-1,m,function(a,b,e){a?g.push(a):d[j]=b,k.push(j),h[j]={err:a,v:m,resp:e},f.length==k.length&&c&&c(g.length?g:null,d,h)}):(k.push(j),d[j]=m[b.__proxies[j].forwardModel.id],h[j]={err:l,v:m},f.length==k.length&&c&&c(g.length?g:null,d,h)):(i.debug.isEnabled&&i.debug("no value for "+j),k.push(j),h[j]={err:l,v:m},f.length==k.length&&c&&c(g.length?g:null,d,h))}))}),f.length||c(null,d,{})}var f=siesta._internal,g=f.log,h=f.util,i=g.loggerWithName("Serialisation"),j=h._;c.depthSerialiser=function(a){return j.partial(e,a)},c.depthSerializer=function(a){return j.partial(e,a)},c.idSerializer=d,c.idSerialiser=d},{}],8:[function(a,b){"use strict";function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,e,f){b=b||"&",e=e||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;j>k;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(e);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),c(g,n)?d(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var d=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],9:[function(a,b){"use strict";function c(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var d=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,g,h){return b=b||"&",g=g||"=",null===a&&(a=void 0),"object"==typeof a?c(f(a),function(f){var h=encodeURIComponent(d(f))+g;return e(a[f])?c(a[f],function(a){return h+encodeURIComponent(d(a))}).join(b):h+encodeURIComponent(d(a[f]))}).join(b):h?encodeURIComponent(d(h))+g+encodeURIComponent(d(a)):""};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],10:[function(a,b,c){"use strict";c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":8,"./encode":9}]},{},[3]);